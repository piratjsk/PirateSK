package net.grota.piratesk.bukkit;

import ch.njol.skript.classes.Changer.ChangeMode;
import ch.njol.skript.expressions.base.SimplePropertyExpression;
import ch.njol.skript.util.Timespan;
import org.bukkit.entity.LivingEntity;
import org.bukkit.event.Event;

public class ExprInvulnerabilityTime extends SimplePropertyExpression<LivingEntity, Timespan> {

    public Timespan convert(final LivingEntity entity) {
        return Timespan.fromTicks(entity.getNoDamageTicks());
    }

    public Class<?>[] acceptChange(final ChangeMode mode) {
        if (mode == ChangeMode.SET || mode == ChangeMode.ADD || mode == ChangeMode.REMOVE)
            return new Class[] {Timespan.class};
        return null;
    }

    public void change(final Event e, final Object[] delta, final ChangeMode mode) {
        final LivingEntity en = getExpr().getSingle(e);
        final int ticks = ((Timespan)delta[0]).getTicks();
        if (mode == ChangeMode.SET) {
            en.setNoDamageTicks(ticks);
        } else if (mode == ChangeMode.ADD) {
            en.setNoDamageTicks(en.getNoDamageTicks()+ticks);
        } else if (mode == ChangeMode.REMOVE){
            en.setNoDamageTicks(en.getNoDamageTicks()-ticks);
        }
    }

    protected String getPropertyName() {
        return "invulnerability time";
    }

    public Class<? extends Timespan> getReturnType() {
        return Timespan.class;
    }

}
